{"is_source_file": true, "format": "Python", "description": "This Python module provides dependencies for authentication and authorization in a FastAPI application. It includes fallback mechanisms for roles, principals, and OIDC token extraction, allowing the app to operate in different environments (development or production). It mainly exposes functions to get the current authenticated user, verify required roles, and sets up security dependencies.", "external_files": ["app.core.security.roles", "app.schemas.security", "app.core.security.oidc"], "external_methods": ["app.core.security.roles.Role", "app.schemas.security.Principal", "app.core.security.oidc.get_current_principal"], "published": ["get_current_user", "require_roles", "CurrentUser"], "classes": [{"name": "Principal", "description": "Dataclass representing an authenticated user principal, including claims like subject, email, and roles."}, {"name": "Role", "description": "Enum or fallback str-based class defining user roles such as LEARNER, EMPLOYEE, INSTRUCTOR, etc."}], "methods": [{"name": "get_current_principal", "description": "Function to extract and validate a bearer token, returning a Principal. Uses fallback logic when real OIDC validation is not configured."}, {"name": "get_current_user", "description": "Wrapper function returning the current Principal, depending on the successful execution of get_current_principal."}, {"name": "require_roles", "description": "Factory function returning a dependency that enforces that the current user has at least one of the required roles."}], "calls": ["Depends", "HTTPException", "status.HTTP_401_UNAUTHORIZED", "status.HTTP_403_FORBIDDEN", "cast", "tuple"], "search-terms": ["authentication dependencies", "FastAPI security", "Principal fallback", "Role enum", "RBAC dependency", "get_current_user", "require_roles"], "state": 2, "file_id": 12, "knowledge_revision": 37, "git_revision": "b03ee7c8ca0c5cedd12417956edf848acaa6dcdf", "ctags": [], "hash": "1656d92f2aec6a52542472e8a6a13f07", "format-version": 4, "code-base-name": "CoreAPI&Services", "filename": "CoreAPI&Services/app/api/deps.py", "revision_history": [{"37": "b03ee7c8ca0c5cedd12417956edf848acaa6dcdf"}]}