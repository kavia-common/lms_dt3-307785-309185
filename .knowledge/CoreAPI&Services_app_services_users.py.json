{"is_source_file": true, "format": "Python", "description": "This file defines the UsersService class which provides CRUD operations for user entities stored in a MongoDB database using Motor and FastAPI. It includes methods for creating, retrieving, updating, listing, and soft-deleting users, implementing indexes setup, data serialization, and exception handling.", "external_files": ["app.core.mongo_utils", "app.schemas.users"], "external_methods": ["not_deleted_filter", "serialize_mongo_doc", "soft_delete_update", "to_object_id", "UserCreate", "UserListResponse", "UserRead", "UserUpdate"], "published": ["UsersService"], "classes": [{"name": "UsersService", "description": "Service class responsible for managing user data in MongoDB, including creating, reading, updating, listing, and soft deleting user records."}], "methods": [{"name": "__init__", "description": "Initializes the UsersService with a MongoDB database connection."}, {"name": "_ensure_indexes", "description": "Creates necessary indexes on the users collection if they do not exist."}, {"name": "_doc_to_read", "description": "Converts a MongoDB document to a UserRead schema."}, {"name": "create_user", "description": "Creates a new user document in the database, handling duplicate email errors."}, {"name": "get_user", "description": "Retrieves a user by ID, raising 404 if not found."}, {"name": "list_users", "description": "Lists users with pagination support."}, {"name": "update_user", "description": "Updates user data by ID, handling email conflicts and non-existence."}, {"name": "delete_user", "description": "Soft-deletes a user by ID."}], "calls": ["self._db[self.collection_name]", "coll.create_index", "coll.count_documents", "coll.find", "coll.update_one", "coll.insert_one", "coll.find_one"], "search-terms": ["UsersService", "MongoDB user management", "FastAPI user CRUD", "async create_user", "soft delete user", "Mongo duplicates handling", "pagination in list_users"], "state": 2, "file_id": 30, "knowledge_revision": 99, "git_revision": "19710407e292302c797f1a8602379f1eacc3005b", "revision_history": [{"86": "f32db9f7648c3bf6e6253d6e6d769aa42b98ef52"}, {"99": "19710407e292302c797f1a8602379f1eacc3005b"}], "ctags": [], "hash": "9f70bd076dcff69bcd3252e541f91092", "format-version": 4, "code-base-name": "CoreAPI&Services", "filename": "CoreAPI&Services/app/services/users.py"}