{"is_source_file": true, "format": "Python", "description": "This is a test script for FastAPI application that verifies RBAC (Role-Based Access Control) enforcement on user-related API endpoints. It contains tests for authentication requirements, role-based permissions, and user deletion authorization.", "external_files": ["fastapi.testclient.TestClient", "app.api.routers.users.get_users_service", "app.core.config.clear_settings_cache", "app.main.create_app", "app.core.db.get_db", "app.tests.test_helpers.override_db", "datetime.datetime", "datetime.timezone"], "external_methods": ["create_app", "clear_settings_cache", "get_db", "override_db"], "published": [], "classes": [{"name": "_FakeDB", "description": "Placeholder fake database class used to override the real database dependency during tests."}, {"name": "_FakeUsersService", "description": "Mock service class with methods to simulate user listing and deletion for testing RBAC and API behavior."}], "methods": [{"name": "test_users_list_requires_auth", "description": "Test that fetching /users endpoint requires authentication (checks for 401 Unauthorized)."}, {"name": "test_users_list_forbidden_without_read_role", "description": "Test that a user without the correct read role receives a 403 Forbidden response."}, {"name": "test_users_list_allowed_with_learner_role", "description": "Test that a user with the Learner role successfully retrieves user list, expecting a 200 OK."}, {"name": "test_users_delete_requires_admin", "description": "Test that deleting a user requires Admin role; others get 403, Admin gets 200."}], "calls": ["create_app()", "clear_settings_cache()", "app.dependency_overrides[get_db]", "app.dependency_overrides[get_users_service]", "client.get()", "client.delete()"], "search-terms": ["RBAC", "test_rbac_enforcement", "FastAPI test", "user API tests", "authorization roles", "test_user_deletion"], "state": 2, "file_id": 47, "knowledge_revision": 156, "git_revision": "a913ada82573d635dee7e06ab499b12fc525201f", "revision_history": [{"150": "749667ff558d78ec1efbd0cd6de8e8a3140a3aa3"}, {"156": "a913ada82573d635dee7e06ab499b12fc525201f"}], "ctags": [], "hash": "ecfcd43491724d2c2ff7345ebf8baf2d", "format-version": 4, "code-base-name": "CoreAPI&Services", "filename": "CoreAPI&Services/app/tests/test_rbac_enforcement.py"}